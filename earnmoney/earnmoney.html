<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <title>玩家挣钱</title>
    <link rel="stylesheet" href="../common/bootstrap-3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../common/css/common.css">
    <link rel="stylesheet" href="css/earnmoney.css">
</head>
<body>
<div id="wrapper">
    <!--<div class="breadNav">
        <ol>
            <li><a href="javascript:void(0)">首页</a></li>
            <li></li>
            <li><a href="javascript:void(0)">玩家挣钱</a></li>
        </ol>
        <div class="mobilePhone">
            观看更多精彩
        </div>
    </div>-->
    <div class="mainLeft">
        <!-- <div class="mainLeft-title">
             看不够的金秋坝上，走一趟北京-内蒙-红山军马场！
         </div>
         <div class="mainLeft-bg">
             <div class="enroll-num">
                 <p>至少要10人报名才能开始</p>
                 <div>
                     <i></i>
                     80/120
                 </div>
             </div>
         </div>
         <div class="enroll-end">
             <div class="enroll-time">
                 距报名截至
                 <span>07</span>
                 <i>天</i>
                 <span>20</span> :
                 <span>17</span> :
                 <span>29</span>
             </div>
         </div>
         <div class="bull-info">
             <div class="supporter">
                 <span>暂无买单者</span>
                 <span>赞助者：</span>获得6家赞助
                 <p>￥<i class="price">1988</i></p>
             </div>
             <div class="time">
                 15.10.23 上午10:00 ~ 15.10.24 下午06:00
             </div>
             <div class="address">
                 汉口火车站中央大厅门口
             </div>
             <div class="phone-num">
                 15001234561
             </div>
             <div class="circleImg">
                 <ul>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li></li>
                     <li>+13</li>
                 </ul>
             </div>
         </div>
         <div class="video-details">
             <video src="#"></video>
             <div class="mask">
                 <div class="play">
                     <i></i>
                 </div>
             </div>
             <div class="txt-details">
                 <div class="details-title">
                     详情介绍
                     <i></i>
                 </div>
                 <div class="main-txt">
                     Lorem ipsum dolor sit amet, consectetur adipisicing elit. Aperiam assumenda, commodi deleniti
                     distinctio dolore enim est excepturi explicabo ipsam iste, minima nam nobis pariatur possimus
                     praesentium quo repellendus veritatis voluptatum. Lorem ipsum dolor sit amet, consectetur
                     adipisicing elit. Amet beatae deleniti dolorem est eum impedit magni optio soluta? Accusantium
                     assumenda consequatur deserunt distinctio enim laboriosam laudantium molestiae obcaecati praesentium
                     unde. Lorem ipsum dolor sit amet, consectetur adipisicing elit. Assumenda deleniti, dolore minima
                     optio provident repudiandae sint voluptatum. Aperiam blanditiis corporis delectus facere hic
                     incidunt ipsa magni quisquam quo, recusandae tempora. Lorem ipsum dolor sit amet, consectetur
                     adipisicing elit. Amet ex, molestias! Accusamus amet corporis dicta, eaque enim et itaque
                     laudantium, magni molestias praesentium quae quisquam reiciendis totam, ullam unde. Explicabo! Lorem
                     ipsum dolor sit amet, consectetur adipisicing elit. Cumque excepturi fugit omnis perferendis sint
                     tempore vel. Consequatur, dicta, doloremque eligendi ex fugiat iste iusto necessitatibus nobis
                     perferendis quae recusandae, rem!
                 </div>
                 <div class="details-img"></div>
             </div>
         </div>-->
    </div>
    <div class="sidebar">
        <!--<div class="issuer">
            <div class="issuer-Info"></div>
            <span>发布人</span>
            <span class="user">亚历桑德拉</span>
            <span class="isreal">实名认证</span>
        </div>-->
        <div class="hotCircle">
            <div class="sidebar-title">
                <h4 class="txt">最热玩家圈活动</h4>
            </div>
            <div class="sidebar-list">
                <ul>
                    <!--<li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">1</i>
                        </div>
                    </li>-->
                    <!--<li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">2</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">3</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">4</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">5</i>
                        </div>
                    </li>-->
                </ul>
            </div>
        </div>
        <div class="hotFans">
            <div class="sidebar-title">
                <h4 class="txt">最热粉团队活动</h4>
            </div>
            <div class="sidebar-list">
                <ul>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">1</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">2</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">3</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">4</i>
                        </div>
                    </li>
                    <li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩团队</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="actionStart">
                                活动开始时间：2017.1.20
                            </p>
                            <i class="num">5</i>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../common/scripts/jquery-1.11.1.min.js"></script>
<script src="../common/scripts/commonUtil.js"></script>
<script>
    (function () {
        //公参
        var detailId = CommonUtil.getUrlParam('detailId');
        var sCurrUserId = CommonUtil.getUrlParam('sCurrUserId');
        var cityId = 4201;
        var userId = 1;
        var pagination = {'page': 1, 'row': 5};

        //左栏渲染
        function mainLefData() {
            var param = "{'detailId':'1671','sCurrUserId':'52142'}";
            var res = CommonUtil.ajaxData("circle/getActivityDetail", param);
            if (res.code == 1) {
                var html = '';
                var timer = null;
                var userHtml = '';
                var row = res.data;
                var now = new Date('2017/02/24 18:44:00').getTime();
                var endTime = new Date(row.detailCutOffTime).getTime();//2017-03-16
                var ms = endTime - now;
                var d = Math.floor(ms / 1000 / 60 / 60 / 24);
                d < 10 ? d = '0' + d : d = d;
                var h = Math.floor(ms / 1000 / 60 / 60 % 24);
                h < 10 ? h = '0' + h : h = h;
                var m = Math.floor(ms / 1000 / 60 % 60);
                m < 10 ? m = '0' + m : m = m;
                var s = Math.floor(ms / 1000 % 60);
                s < 10 ? s = '0' + s : s = s;

                //时间格式替换
                function format(data) {
                    var str = data.split(' ');
                    var font = str[0].split("-").join(".");
                    var endArr = str[1].split(":");
                    var hour = endArr[0] > 12 ? '  下午' + (endArr[0] - 12) : '  上午' + endArr[0];
                    endArr[0] = hour;
                    var newEnd = endArr.join(":");
                    var date = font + '&nbsp;&nbsp;' + newEnd;
                    return date;
                }

                html += '<div class="mainLeft-title">' + row.detailName + '</div>' +
                    '<div class="mainLeft-bg" style="background-image: url(' + row.detailPicUrl + ')">' +
                    '<div class="enroll-num"><p>至少要' + row.detailMinTotal + '人报名才能开始</p><div>' +
                    '<i></i>' + row.enrollListNum + '/' + row.detailMaxTotal + '</div></div></div>' +
                    '<div class="enroll-end">' +
                    '<div class="enroll-time">距报名截至' +
                    '<span>' + d + '</span><i> 天 </i>' +
                    '<span>' + h + '</span> : ' +
                    '<span>' + m + '</span> : ' +
                    '<span>' + s + '</span></div></div>' +
                    '<div class="bull-info"><div class="supporter">' +
                    '<span>暂无买单者</span><span>' +
                    '赞助者：</span>获得' + row.supportNumber + '家赞助<p>￥<i class="price">' + row.detailJoinMoney + '</i></p></div>' +
                    '<div class="time">' + format(row.detailBeginTime) + '&nbsp;&nbsp;~&nbsp;&nbsp;' + format(row.detailEndTime) + '</div>' +
                    '<div class="address">' + row.detailPlace + '</div><div class="phone-num">' + row.detailUserPhone + '</div>' +
                    '<div class="circleImg"><ul>';
                for (var n = 0; n < row.enrollList.length; n++) {
                    html += '<li style="background-image:url(' + row.enrollList[n].enrollUserPic + ') "></li>';
                }
                html += '<li>+' + row.detailAppliedPersonNumber + '</li></ul></div></div>' +
                    '<div class="video-details">';
                for (var i = 0; i < row.appendixList.length; i++) {
                    var data = row.appendixList[i];
                    html += '<video controls="controls" src="' + data.appendixFileUrl + ')"></video>'
                }
                html += '<div class="mask"><div class="play"><i></i></div></div>' +
                    '<div class="txt-details">' +
                    '<div class="details-title">详情介绍<i></i></div><div class="main-txt">' + row.detailProcess + '</div>' +
                    '<div class="details-img"></div></div></div>';

                var width = row.enrollListNum / row.detailMaxTotal * 275;

                //发布人信息
                userHtml = '<div class="issuer"><div class="issuer-Info" style="background-image: url(' + row.detailUserPic + ')"></div>' +
                    '<span>发布人</span><span class="user">' + row.detailUserName + '</span>' +
                    '<span class="isreal" data-isrealname="' + row.isrealname + '"></span></div>'
            } else {
                console.log(res.data);
            }

            $('.mainLeft').html(html);
            $('.sidebar').prepend(userHtml);

            //倒计时
            setInterval(function timer() {
                now += 1000;
                ms = endTime - now;
                d = Math.floor(ms / 1000 / 60 / 60 / 24);
                d < 10 ? d = '0' + d : d = d;
                h = Math.floor(ms / 1000 / 60 / 60 % 24);
                h < 10 ? h = '0' + h : h = h;
                m = Math.floor(ms / 1000 / 60 % 60);
                m < 10 ? m = '0' + m : m = m;
                s = Math.floor(ms / 1000 % 60);
                s < 10 ? s = '0' + s : s = s;
                $('.enroll-time span')[0].innerHTML = d;
                $('.enroll-time span')[1].innerHTML = h;
                $('.enroll-time span')[2].innerHTML = m;
                $('.enroll-time span')[3].innerHTML = s;
                if (ms >= 1000) {
                    timer;
                } else {
                    clearInterval(timer);
                    timer = null;
                    $('.enroll-time span')[0].innerHTML = '00';
                    $('.enroll-time span')[1].innerHTML = '00';
                    $('.enroll-time span')[2].innerHTML = '00';
                    $('.enroll-time span')[3].innerHTML = '00';
                }
            }, 1000);


            //判断详情视频是否为空
            row.appendixList.length == 0 && $('.mask').hide();

            //视频点击播放
            $('.mask .play').click(function () {
                $('.mask').hide();
                $('.video-details video')[0].play();
            });

            //报名人数进度条定位
            $('.enroll-num div:before').css('left', width + 'px');

            //实名认证
            var real = $('.issuer .isreal').attr('data-isrealname');
            switch (real) {
                case '-1':
                    $('.issuer .isreal').html('审核不通过');
                    break;
                case '0':
                    $('.issuer .isreal').html('未验证');
                    break;
                case '1':
                    $('.issuer .isreal').html('待审核');
                    break;
                case '2':
                    $('.issuer .isreal').html('已认证');
                    break;
            }
        }

        //右栏渲染
        function sidebarData() {
            var param = "{'userId':" + userId + ", 'activityType': 2, 'sortBy': 1, 'partake': 0, 'cityId':" + cityId + ", 'activityStatus': '1,2,5,4', 'pagination':" + pagination + "}";
            var res = CommonUtil.ajaxData('circle/getActivityByCondition20', param);
            if (res.code == 1) {
                var html = '';
                for (var i = 0; i < res.data.length; i++) {
                    var row = res.data[i];

                    //日期格式化
                    function formatDate(data) {
                        var str = data.split(' ');
                        var date = str[0].split("-").join(".");
                        return date;
                    }

                    html += '<li><img src="' + row.userPic + '" class="headImg">' +
                        '<div class="info"><p class="title">' + row.userName + '</p><p class="userName">' + row.userName + '</p>' +
                        '<p class="actionStart">活动开始时间：' + formatDate(row.detailBeginTime) + '</p><i class="num">' + (i + 1) + '</i></div></li>';
                }
            } else {
                console.log(res.data);
            }
            $('.hotCircle ul').html(html);
        }

        mainLefData();
        sidebarData();
    })();
</script>
</html>