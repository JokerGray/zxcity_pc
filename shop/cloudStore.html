<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <title>同城云店</title>
    <link rel="stylesheet" href="../common/bootstrap-3.3.7/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../common/css/common.css">
    <link rel="stylesheet" href="css/cloudStore.css">
</head>
<body>
<div id="wrapper">
    <!--<div class="breadNav">
        <ol>
            <li><a href="javascript:void(0)">首页</a></li>
            <li></li>
            <li><a href="javascript:void(0)">同城云店</a></li>
        </ol>
        <div class="mobilePhone">
            观看更多精彩
        </div>
    </div>-->
    <div class="mainLeft">
        <div class="tabs">
            <a href="javascript:void(0)" class="active">特惠</a>
            <a href="javascript:void(0)">活动</a>
            <a href="javascript:void(0)">资讯</a>
            <a href="javascript:void(0)">视频</a>
            <a href="javascript:void(0)">商品</a>
        </div>
        <div class="content-box">
            <div class="content content-1">
                <div class="title">
                    <!--<h2>特惠商品</h2>-->
                    <div class="share">
                        <span>分享给朋友：</span>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                    </div>
                </div>
                <div class="shop">
                    <!--<div class="shopInfo">
                        <img src="img/shopImg.png">
                        <p class="goodsName">Draconite 复古拼接双肩...</p>
                        <p class="shopName">徐东销品茂Draconite服饰店</p>
                        <p class="price">
                            ￥<span class="num">249.00</span>
                        </p>
                    </div>-->
                </div>
            </div>
            <div class="content content-2">
                <div class="title">
                    <!--<h2>特惠商品</h2>-->
                    <div class="share">
                        <span>分享给朋友：</span>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                    </div>
                </div>
                <div class="action">
                    <!--<div class="actionInfo">
                        <div class="titleName">
                            <i></i>
                            <span>玩家圈</span>
                        </div>
                        <div class="price">
                            <div class="cur-price">
                                ￥<span>1.00</span>
                            </div>
                            <div class="cos-price">
                                原价：￥<span>5598</span>
                            </div>
                        </div>
                        <div class="countDown">
                            <p>距离报名截至</p>
                            <span>52</span>:<span>17</span>:<span>29</span>
                        </div>
                        <div class="enroll">
                            报名人数<span>24</span>/<span>30</span>
                        </div>
                    </div>
                    <div class="action-txt">
                        看不够的金秋坝上，走一趟红山军马场
                    </div>
                    <div class="action-date">
                        <span class="day-start">2016.02.20</span>
                        <span class="hou-start">10:28</span> ~
                        <span class="day-end">2016.02.30</span>
                        <span class="hou-end">18:00</span>
                    </div>
                    <div class="support">
                        <span class="boss">已有BOSS为此活动买单</span>
                        <span class="seller">已有商家赞助</span>
                    </div>-->
                </div>
            </div>
            <div class="content content-3">
                <div class="title">
                    <div class="share">
                        <span>分享给朋友：</span>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                    </div>
                </div>
                <!--<div class="info">
                    <div class="info-title">
                        十一写真集拍摄前50名享7折优惠,先到先得！
                    </div>
                    <div class="infoImg">
                        <div class="infoIcon">
                            <i></i>
                            <span>9</span>图
                        </div>
                    </div>
                    <div class="storeInfo">
                        <div class="storeLogo">
                            <i></i>
                            <span class="storeName">雨果摄影徐东店</span>
                        </div>
                        <div class="storeDate">
                            <span>05-06</span>
                            <span>02:14</span>
                        </div>
                        <div class="comment">
                            <i></i>
                            <span class="commentNum">21</span>
                        </div>
                    </div>
                </div>-->
                <!--<div class="info">
                    <div class="info-title">
                        十一写真集拍摄前50名享7折优惠,先到先得！
                    </div>
                    <video src="#" controls="controls" poster="img/infoImg.png"></video>
                    <div class="storeInfo">
                        <div class="storeLogo">
                            <i></i>
                            <span class="storeName">雨果摄影徐东店</span>
                        </div>
                        <div class="storeDate">
                            <span>05-06</span>
                            <span>02:14</span>
                        </div>
                        <div class="comment">
                            <i></i>
                            <span class="commentNum">21</span>
                        </div>
                    </div>
                </div>-->
            </div>
            <div class="content content-4">
                <div class="title">
                    <div class="share">
                        <span>分享给朋友：</span>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                    </div>
                </div>
                <!--<div class="video">
                    <video src="#"></video>
                    <div class="mask">
                        <span><i></i></span>
                    </div>
                </div>-->
            </div>
            <div class="content content-5">
                <div class="title">
                    <div class="share">
                        <span>分享给朋友：</span>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                        <a href="javascript:void(0)"></a>
                    </div>
                </div>
                <div class="shop">
                    <!--<div class="shopInfo">
                        <img src="img/shopImg.png">
                        <p class="goodsName">Draconite 复古拼接双肩...</p>
                        <p class="shopName">徐东销品茂Draconite服饰店</p>
                        <p class="price">
                            ￥<span class="num">249.00</span>
                        </p>
                    </div>-->
                </div>
            </div>
        </div>
    </div>
    <div class="sidebar">
        <div class="sidebar-adv">
            <!-- <div class="shopInfo">
                 <i class="logo"></i>
                 <p>乐视旗舰店</p>
                 <p>乐视旗舰店是一家XXXXXX公司</p>
             </div>-->
            <div class="adv"></div>
            <div class="adv"></div>
        </div>
        <div class="storeChoice">
            <div class="sidebar-title">
                <h4 class="txt">同城云店精选排行</h4>
            </div>
            <div class="sidebar-list">
                <ul>
                    <!--<li>
                        <img src="img/person.png" class="headImg">
                        <div class="info">
                            <p class="title">团队爬山游玩</p>
                            <p class="userName">迷雾的胖子</p>
                            <p class="praise">
                                <i></i>
                                <span class="count">1200</span>
                            </p>
                            <i class="num">1</i>
                        </div>
                    </li>-->
                </ul>
            </div>
        </div>
    </div>
</div>
</body>
<script src="../common/scripts/jquery-1.11.1.min.js"></script>
<script src="../common/scripts/commonUtil.js"></script>
<script>
    (function () {
        /*var createUser = CommonUtil.getUrlParam('createUser');
         var dynamicId = CommonUtil.getUrlParam("dynamicId");
         var shopId = CommonUtil.getUrlParam("shopId");*/

        //tabs页切换
        $('#wrapper .tabs a').click(function () {
            var index = $(this).index();
            $(this).addClass('active').siblings().removeClass();
            $('.content-box .content').eq(index).show().siblings().hide();
        });

        //商品/特惠
        function shopData() {
            var param = "{'shopId':298,'pageNo':1,'pageSize':10}"
            var res = CommonUtil.ajaxData('shop/getThisShopAllGoods', param);
            if (res.code == 1) {
                for (var i = 0; i < res.data.length; i++) {
                    var row = res.data[i];
                    var html = '';
                    html += '<div class="shopInfo">' +
                        '<img src="' + row.pictureUrl + '">' +
                        '<p class="goodsName">' + row.brandName + '&nbsp;' + row.goodsName + '</p>' +
                        '<p class="shopName">' + row.shopAddress + '' + row.shopName + '</p>' +
                        '<p class="price">￥<span class="num">' + row.marketPrice + '</span></p></div>';
                }
                $('.shop').html(html);
            }
        }

        shopData();

        //活动
        function actionData() {
            var param = "{'pageNo':1,'pageSize':1,'shopId':298}";
            var res = CommonUtil.ajaxData('shop/shopHomeActivities', param);
            if (res.code == 1) {
                var html = '';
                var timer = null;
                for (var i = 0; i < res.data.length; i++) {
                    var row = res.data[i];
                    var now = new Date('2017/01/18 23:59:45').getTime();//2016.12.10
                    var endTime = new Date(row.detailCutOffTime).getTime();//2017-01-19
                    var ms = endTime - now;
                    var h = Math.floor(ms / 1000 / 60 / 60);
                    h < 10 ? h = '0' + h : h = h;
                    var m = Math.floor(ms / 1000 / 60 % 60);
                    m < 10 ? m = '0' + m : m = m;
                    var s = Math.floor(ms / 1000 % 60);
                    s < 10 ? s = '0' + s : s = s;


                    //时间格式替换
                    function format(data) {
                        var str = data.split(' ');
                        var font = str[0].split("-").join(".");
                        var endArr = str[1].split(":");
                        var newEnd = endArr.join(":");
                        var date = font + '&nbsp;&nbsp;' + newEnd;
                        return date;
                    }

                    html += '<div class="actionInfo" style="background-image: url(' + row.detailPicUrl + ')">' +
                        '<div class="titleName"><i></i><span>玩家圈</span></div>' +
                        '<div class="price"><div class="cur-price">￥<span>1.00</span></div>' +
                        '<div class="cos-price">原价：￥<span>' + row.detailJoinMoney + '</span></div></div><div class="countDown"><p>距离报名截至</p>' +
                        '<span>' + h + '</span>:' +
                        '<span>' + m + '</span>:' +
                        '<span>' + s + '</span></div>' +
                        '<div class="enroll">报名人数<span>' + row.detailRealJoinNumber + '</span>/<span>' + row.detailMaxTotal + '</span></div></div><div class="action-txt">' + row.detailName + '</div>' +
                        '<div class="action-date"><span class="day-start">' + format(row.detailBeginTime) + '</span> ~ <span class="day-end">' + format(row.detailEndTime) + '</span></div><div class="support"><span class="boss" data-detailIsBossPay="' + row.detailIsBossPay + '">已有BOSS为此活动买单</span><span class="seller" data-detailIsMerchantSupport="' + row.detailIsMerchantSupport + '">已有商家赞助</span></div>';
                }

                $('.action').html(html);

                //倒计时
                setInterval(function timer() {
                    now += 1000;
                    ms = endTime - now;
                    h = Math.floor(ms / 1000 / 60 / 60);
                    h < 10 ? h = '0' + h : h = h;
                    m = Math.floor(ms / 1000 / 60 % 60);
                    m < 10 ? m = '0' + m : m = m;
                    s = Math.floor(ms / 1000 % 60);
                    s < 10 ? s = '0' + s : s = s;
                    $('.countDown span')[0].innerHTML = h;
                    $('.countDown span')[1].innerHTML = m;
                    $('.countDown span')[2].innerHTML = s;
                    if (ms >= 1000) {
                        timer;
                    } else {
                        clearInterval(timer);
                        timer = null;
                        $('.countDown span')[0].innerHTML = '00';
                        $('.countDown span')[1].innerHTML = '00';
                        $('.countDown span')[2].innerHTML = '00';
                    }
                }, 1000);

                //是否Boss买单
                if ($('.boss').attr('data-detailIsBossPay') == 0) {
                    $('.boss').show();
                } else {
                    $('.boss').hide();
                }

                //是否商家赞助
                if ($('.seller').attr('data-detailIsMerchantSupport') == 0) {
                    $('.seller').show();
                } else {
                    $('.seller').hide();
                }
            }
        }

        actionData();

        //资讯
        function infoData() {
            var param = "{'pageNo':1,'pageSize':2,'shopId':298}";
            var res = CommonUtil.ajaxData('shop/shopHomeArticles', param);
            var html = '';
            for (var i = 0; i < res.data.length; i++) {
                var row = res.data[i];
                html += '<div class="info"><div class="info-title">' + row.articleTitle + '</div>';
                //如果是视频
                if (row.typeCode == 1003) {
                    var bgImg = row.scCmsResourcesList[0].resourcesUrl;
                    var videoUrl = row.scCmsResourcesList[1].resourcesUrl;
                    html += '<video src="' + videoUrl + '" controls="controls" poster="' + bgImg + '"></video>';

                    //如果是图组
                } else if (row.typeCode == 1001) {
                    html += '<div class="infoImg" style="background-image: url(' + row.scCmsResourcesList[0].resourcesUrl + ')"><div class="infoIcon"><i></i><span>' + row.scCmsResourcesList[0].resourcesRemarks + '</span>图</div></div>';
                }
                html += '<div class="storeInfo"><div class="storeLogo"><i></i>' +
                    '<span class="storeName">' + row.scSysUser.username + '</span></div>' +
                    '<div class="storeDate"><span>' + row.releaseTime + '</span></div>' +
                    '<div class="comment"><i></i>' +
                    '<span class="commentNum">' + row.totalVisitNumber + '</span></div></div></div>';
            }
            $('.content-3').append(html);
        }

        infoData();

        //视频
        function videoData() {
            var param = "{'shopId':298}"
            var res = CommonUtil.ajaxData('shop/shopHomeVideos', param);
            var html = '';
            if (res.code == 1) {
                for (var i = 0; i < res.data.length; i++) {
                    var row = res.data[i];
                    html += '<div class="video"><video src="' + row.filePath + '" controls="controls"></video>' +
                        '<div class="mask"><span><i></i></span></div></div>'
                }
                $('.content-4').append(html);

                //视频播放
                $('.mask i').click(function () {
                    $('.mask').hide();
                    $('.video video')[0].play();
                    $('.video video').addClass('played');
                })
                //暂停播放
                $('.video video').click(function () {
                    if ($(this).hasClass('played')) {
                        $(this)[0].pause();
                        $(this).removeClass('played');
                    } else {
                        $(this)[0].play();
                        $(this).addClass('played');
                    }
                })
            }
        }

        videoData();

        //店铺信息
        function mainRightData() {
            var param = "{'customerId':1,'shopId':298}";
            var res = CommonUtil.ajaxData('shop/shopHomeInfoV3', param);
            if (res.code == 1) {
                var row = res.data.shopInfo;
                var bgArr = row.bgImage.split(',');
                var html = '<div class="shopInfo" style="background-image: url(' + bgArr[0] + ')"><div class="mask"></div><i class="logo" style="background-image: url(' + row.logoUrl + ')"></i><p>' + row.shopName + '</p><p>' + row.shopDesc + '</p></div>';
            }
            $('.sidebar-adv').prepend(html);
        }

        mainRightData();

        //精选排行
        function storeData() {
            var param = "{'pageNo':1,'pageSize':5,'sortType':0}";
            var res = CommonUtil.ajaxData('shop/bestShopTopList', param);
            if (res.code == 1) {
                var html = '<li><img src="img/person.png" class="headImg"><div class="info"><p class="title"></p><p class="userName"></p><p class="praise"><i></i><span class="count"></span></p><i class="num"></i></div></li>';
                for (var i = 0; i < res.data.length; i++) {
                    var dom = $($.parseHTML(html));
                    var row = res.data[i];
                    dom.find('.headImg').attr('src', row.logoUrl);
                    dom.find('.title').html(row.shopName);
                    dom.find('.userName').html(row.name);
                    dom.find('.num').html((i + 1));
                    dom.find('.count').html(row.monthSellCnt);
                    $('.sidebar-list ul').append(dom);
                }
            }
        }

        storeData();

    })();
</script>
</html>